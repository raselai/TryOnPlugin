{"version":3,"file":"widget.js","sources":["../src/styles.ts","../src/state.ts","../src/config.ts","../src/components/ConsentGate.ts","../src/utils/compression.ts","../src/utils/exif.ts","../src/utils/validation.ts","../src/components/Progress.ts","../src/services/api.ts","../src/components/Upload.ts","../src/events.ts","../src/components/Result.ts","../src/components/Modal.ts","../src/api.ts","../src/main.ts"],"sourcesContent":["export const styles = `\n:host {\n  all: initial;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 16px;\n  line-height: 1.5;\n  color: #1a1a1a;\n  box-sizing: border-box;\n}\n\n*, *::before, *::after {\n  box-sizing: border-box;\n}\n\n.backdrop {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2147483647;\n  opacity: 0;\n  transition: opacity 0.2s ease;\n}\n\n.backdrop.visible {\n  opacity: 1;\n}\n\n.modal {\n  background: #fff;\n  width: min(480px, 92vw);\n  max-height: 90vh;\n  overflow: auto;\n  border-radius: 16px;\n  padding: 24px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n  transform: scale(0.95);\n  transition: transform 0.2s ease;\n}\n\n.backdrop.visible .modal {\n  transform: scale(1);\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 20px;\n}\n\n.title {\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.close-btn {\n  width: 32px;\n  height: 32px;\n  border: none;\n  background: #f5f5f5;\n  border-radius: 50%;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  color: #666;\n  transition: background 0.15s;\n}\n\n.close-btn:hover {\n  background: #e5e5e5;\n}\n\n/* Consent View */\n.consent-content {\n  text-align: center;\n  padding: 20px 0;\n}\n\n.consent-icon {\n  font-size: 48px;\n  margin-bottom: 16px;\n}\n\n.consent-title {\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0 0 12px 0;\n}\n\n.consent-text {\n  color: #666;\n  margin: 0 0 8px 0;\n  font-size: 14px;\n}\n\n.consent-link {\n  color: #0066cc;\n  text-decoration: none;\n}\n\n.consent-link:hover {\n  text-decoration: underline;\n}\n\n.consent-actions {\n  display: flex;\n  gap: 12px;\n  margin-top: 24px;\n  justify-content: center;\n}\n\n/* Upload View */\n.upload-zone {\n  border: 2px dashed #ddd;\n  border-radius: 12px;\n  padding: 32px;\n  text-align: center;\n  cursor: pointer;\n  transition: border-color 0.15s, background 0.15s;\n}\n\n.upload-zone:hover,\n.upload-zone.dragover {\n  border-color: #0066cc;\n  background: #f8faff;\n}\n\n.upload-icon {\n  font-size: 40px;\n  margin-bottom: 12px;\n}\n\n.upload-title {\n  font-weight: 600;\n  margin: 0 0 8px 0;\n}\n\n.upload-subtitle {\n  color: #666;\n  font-size: 14px;\n  margin: 0;\n}\n\n.upload-input {\n  display: none;\n}\n\n.photo-guidance {\n  background: #f8f9fa;\n  border-radius: 8px;\n  padding: 12px;\n  margin-top: 16px;\n  font-size: 13px;\n  color: #666;\n}\n\n.photo-guidance-title {\n  font-weight: 600;\n  margin: 0 0 4px 0;\n  color: #333;\n}\n\n.preview-container {\n  margin-top: 16px;\n}\n\n.preview-image {\n  width: 100%;\n  max-height: 300px;\n  object-fit: contain;\n  border-radius: 8px;\n  border: 1px solid #eee;\n}\n\n.preview-actions {\n  display: flex;\n  gap: 12px;\n  margin-top: 16px;\n}\n\n/* Progress View */\n.progress-content {\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.spinner {\n  width: 48px;\n  height: 48px;\n  border: 3px solid #eee;\n  border-top-color: #0066cc;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n  margin: 0 auto 20px;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.progress-text {\n  font-weight: 500;\n  margin: 0 0 8px 0;\n}\n\n.progress-subtext {\n  color: #666;\n  font-size: 14px;\n  margin: 0;\n}\n\n.cancel-btn {\n  margin-top: 24px;\n}\n\n/* Result View */\n.result-content {\n  text-align: center;\n}\n\n.result-image-container {\n  position: relative;\n  cursor: pointer;\n}\n\n.result-image {\n  width: 100%;\n  max-height: 400px;\n  object-fit: contain;\n  border-radius: 8px;\n  transition: transform 0.2s;\n}\n\n.result-image.zoomed {\n  transform: scale(1.5);\n  cursor: zoom-out;\n}\n\n.zoom-hint {\n  font-size: 12px;\n  color: #888;\n  margin: 8px 0 0 0;\n}\n\n.result-actions {\n  display: flex;\n  gap: 12px;\n  margin-top: 20px;\n  justify-content: center;\n}\n\n/* Error View */\n.error-content {\n  text-align: center;\n  padding: 20px;\n}\n\n.error-icon {\n  font-size: 48px;\n  margin-bottom: 16px;\n}\n\n.error-title {\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0 0 8px 0;\n}\n\n.error-text {\n  color: #666;\n  margin: 0 0 20px 0;\n}\n\n/* Buttons */\n.btn {\n  padding: 12px 24px;\n  border-radius: 8px;\n  border: none;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: background 0.15s, transform 0.1s;\n}\n\n.btn:active {\n  transform: scale(0.98);\n}\n\n.btn-primary {\n  background: #0066cc;\n  color: #fff;\n}\n\n.btn-primary:hover {\n  background: #0052a3;\n}\n\n.btn-secondary {\n  background: #f5f5f5;\n  color: #333;\n}\n\n.btn-secondary:hover {\n  background: #e5e5e5;\n}\n\n.btn-success {\n  background: #22c55e;\n  color: #fff;\n}\n\n.btn-success:hover {\n  background: #16a34a;\n}\n\n.btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n`;\n","export type View = 'closed' | 'consent' | 'upload' | 'processing' | 'result' | 'error';\n\nexport type TryOnResult = {\n  imageBase64: string;\n  mimeType: string;\n};\n\nexport type State = {\n  view: View;\n  userPhoto: File | null;\n  productImageUrl: string;\n  productId?: string;\n  result: TryOnResult | null;\n  error: string | null;\n  progress: string;\n};\n\ntype Listener = (state: State) => void;\n\nconst initialState: State = {\n  view: 'closed',\n  userPhoto: null,\n  productImageUrl: '',\n  productId: undefined,\n  result: null,\n  error: null,\n  progress: ''\n};\n\nlet state: State = { ...initialState };\nconst listeners: Set<Listener> = new Set();\n\nexport function getState(): State {\n  return state;\n}\n\nexport function setState(partial: Partial<State>): void {\n  state = { ...state, ...partial };\n  listeners.forEach(listener => listener(state));\n}\n\nexport function resetState(): void {\n  state = { ...initialState };\n  listeners.forEach(listener => listener(state));\n}\n\nexport function subscribe(listener: Listener): () => void {\n  listeners.add(listener);\n  return () => listeners.delete(listener);\n}\n\nexport function openWidget(productImageUrl: string, productId?: string): void {\n  const hasConsent = localStorage.getItem('tryon-consent') === 'true';\n  setState({\n    view: hasConsent ? 'upload' : 'consent',\n    productImageUrl,\n    productId,\n    result: null,\n    error: null,\n    progress: ''\n  });\n}\n\nexport function closeWidget(): void {\n  setState({ view: 'closed' });\n}\n\nexport function setConsent(accepted: boolean): void {\n  if (accepted) {\n    localStorage.setItem('tryon-consent', 'true');\n    setState({ view: 'upload' });\n  } else {\n    closeWidget();\n  }\n}\n\nexport function setUserPhoto(file: File): void {\n  setState({ userPhoto: file });\n}\n\nexport function startProcessing(): void {\n  setState({ view: 'processing', progress: 'Uploading...', error: null });\n}\n\nexport function setProgress(progress: string): void {\n  setState({ progress });\n}\n\nexport function setResult(result: TryOnResult): void {\n  setState({ view: 'result', result });\n}\n\nexport function setError(error: string): void {\n  setState({ view: 'error', error });\n}\n\nexport function retryWithSamePhoto(): void {\n  setState({ view: 'upload', error: null, result: null });\n}\n","export interface WidgetConfig {\n  apiBaseUrl: string;\n  privacyPolicyUrl: string;\n  apiKey: string | null;\n}\n\nconst defaultConfig: WidgetConfig = {\n  apiBaseUrl: 'http://localhost:8787',\n  privacyPolicyUrl: '#',\n  apiKey: null\n};\n\nlet config: WidgetConfig = { ...defaultConfig };\n\nexport function getConfig(): WidgetConfig {\n  return config;\n}\n\nexport function setConfig(newConfig: Partial<WidgetConfig>): void {\n  config = { ...config, ...newConfig };\n}\n\nexport function getApiKey(): string | null {\n  return config.apiKey;\n}\n","import { setConsent, closeWidget } from '../state';\nimport { getConfig } from '../config';\n\nexport function renderConsent(container: HTMLElement): void {\n  const config = getConfig();\n  const privacyUrl = config.privacyPolicyUrl || '#';\n\n  container.innerHTML = `\n    <div class=\"consent-content\">\n      <div class=\"consent-icon\">&#128247;</div>\n      <h3 class=\"consent-title\">Photo Permission Required</h3>\n      <p class=\"consent-text\">\n        To create your virtual try-on, we need to process your photo.\n        Your photo is only used for this try-on and is not stored.\n      </p>\n      <p class=\"consent-text\">\n        <a href=\"${escapeAttr(privacyUrl)}\" target=\"_blank\" rel=\"noopener\" class=\"consent-link\">\n          View Privacy Policy\n        </a>\n      </p>\n      <div class=\"consent-actions\">\n        <button class=\"btn btn-primary\" id=\"consent-accept\">I Agree</button>\n        <button class=\"btn btn-secondary\" id=\"consent-decline\">No Thanks</button>\n      </div>\n    </div>\n  `;\n\n  container.querySelector('#consent-accept')?.addEventListener('click', () => {\n    setConsent(true);\n  });\n\n  container.querySelector('#consent-decline')?.addEventListener('click', () => {\n    setConsent(false);\n  });\n}\n\nfunction escapeAttr(text: string): string {\n  return text.replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n}\n","const MAX_DIMENSION = 2048;\nconst MAX_BYTES = 2_000_000;\nconst INITIAL_QUALITY = 0.9;\nconst MIN_QUALITY = 0.5;\nconst QUALITY_STEP = 0.1;\n\nexport async function compressImage(file: File | Blob, maxBytes = MAX_BYTES): Promise<Blob> {\n  const img = await loadImage(file);\n\n  // Calculate resize dimensions\n  let { width, height } = img;\n  if (width > MAX_DIMENSION || height > MAX_DIMENSION) {\n    const ratio = Math.min(MAX_DIMENSION / width, MAX_DIMENSION / height);\n    width = Math.round(width * ratio);\n    height = Math.round(height * ratio);\n  }\n\n  // Create canvas and draw resized image\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  if (!ctx) throw new Error('Failed to get canvas context');\n\n  ctx.drawImage(img, 0, 0, width, height);\n\n  // Try to get under maxBytes with quality reduction\n  let quality = INITIAL_QUALITY;\n  let blob = await canvasToBlob(canvas, 'image/jpeg', quality);\n\n  while (blob.size > maxBytes && quality > MIN_QUALITY) {\n    quality -= QUALITY_STEP;\n    blob = await canvasToBlob(canvas, 'image/jpeg', quality);\n  }\n\n  // If still too large, resize further\n  if (blob.size > maxBytes) {\n    const ratio = Math.sqrt(maxBytes / blob.size) * 0.9;\n    canvas.width = Math.round(width * ratio);\n    canvas.height = Math.round(height * ratio);\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n    blob = await canvasToBlob(canvas, 'image/jpeg', MIN_QUALITY);\n  }\n\n  return blob;\n}\n\nfunction loadImage(file: File | Blob): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    const url = URL.createObjectURL(file);\n\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve(img);\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load image'));\n    };\n\n    img.src = url;\n  });\n}\n\nfunction canvasToBlob(canvas: HTMLCanvasElement, type: string, quality: number): Promise<Blob> {\n  return new Promise((resolve, reject) => {\n    canvas.toBlob(\n      (blob) => {\n        if (blob) resolve(blob);\n        else reject(new Error('Failed to create blob'));\n      },\n      type,\n      quality\n    );\n  });\n}\n","/**\n * Read EXIF orientation from JPEG and auto-rotate if needed\n */\nexport async function fixOrientation(file: File): Promise<Blob> {\n  // Only process JPEG files\n  if (!file.type.includes('jpeg') && !file.type.includes('jpg')) {\n    return file;\n  }\n\n  const orientation = await getExifOrientation(file);\n\n  // No rotation needed\n  if (orientation <= 1) {\n    return file;\n  }\n\n  return rotateImage(file, orientation);\n}\n\nasync function getExifOrientation(file: File): Promise<number> {\n  try {\n    const buffer = await file.slice(0, 65536).arrayBuffer();\n    const view = new DataView(buffer);\n\n    // Check for JPEG marker\n    if (view.getUint16(0) !== 0xFFD8) {\n      return 1;\n    }\n\n    let offset = 2;\n    while (offset < view.byteLength - 2) {\n      const marker = view.getUint16(offset);\n      offset += 2;\n\n      // APP1 marker (EXIF)\n      if (marker === 0xFFE1) {\n        const length = view.getUint16(offset);\n        offset += 2;\n\n        // Check for \"Exif\\0\\0\"\n        const exifHeader = String.fromCharCode(\n          view.getUint8(offset),\n          view.getUint8(offset + 1),\n          view.getUint8(offset + 2),\n          view.getUint8(offset + 3)\n        );\n        if (exifHeader !== 'Exif') {\n          return 1;\n        }\n        offset += 6;\n\n        // TIFF header\n        const littleEndian = view.getUint16(offset) === 0x4949;\n        offset += 2;\n\n        // Skip TIFF magic number\n        offset += 2;\n\n        // IFD0 offset\n        const ifdOffset = view.getUint32(offset, littleEndian);\n        offset = offset - 4 + ifdOffset;\n\n        // Number of entries\n        const numEntries = view.getUint16(offset, littleEndian);\n        offset += 2;\n\n        // Search for orientation tag (0x0112)\n        for (let i = 0; i < numEntries; i++) {\n          const tag = view.getUint16(offset, littleEndian);\n          if (tag === 0x0112) {\n            return view.getUint16(offset + 8, littleEndian);\n          }\n          offset += 12;\n        }\n\n        return 1;\n      } else if ((marker & 0xFF00) === 0xFF00) {\n        // Skip other markers\n        offset += view.getUint16(offset);\n      } else {\n        break;\n      }\n    }\n\n    return 1;\n  } catch {\n    return 1;\n  }\n}\n\nasync function rotateImage(file: File, orientation: number): Promise<Blob> {\n  const img = await loadImage(file);\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  if (!ctx) throw new Error('Failed to get canvas context');\n\n  let width = img.width;\n  let height = img.height;\n\n  // Swap dimensions for 90/270 degree rotations\n  if (orientation >= 5 && orientation <= 8) {\n    canvas.width = height;\n    canvas.height = width;\n  } else {\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  // Apply transformation based on orientation\n  switch (orientation) {\n    case 2: // Horizontal flip\n      ctx.scale(-1, 1);\n      ctx.translate(-width, 0);\n      break;\n    case 3: // 180 degree rotation\n      ctx.rotate(Math.PI);\n      ctx.translate(-width, -height);\n      break;\n    case 4: // Vertical flip\n      ctx.scale(1, -1);\n      ctx.translate(0, -height);\n      break;\n    case 5: // 90 CW + horizontal flip\n      ctx.rotate(0.5 * Math.PI);\n      ctx.scale(1, -1);\n      break;\n    case 6: // 90 CW\n      ctx.rotate(0.5 * Math.PI);\n      ctx.translate(0, -height);\n      break;\n    case 7: // 90 CCW + horizontal flip\n      ctx.rotate(-0.5 * Math.PI);\n      ctx.translate(-width, 0);\n      ctx.scale(1, -1);\n      break;\n    case 8: // 90 CCW\n      ctx.rotate(-0.5 * Math.PI);\n      ctx.translate(-width, 0);\n      break;\n  }\n\n  ctx.drawImage(img, 0, 0);\n\n  return new Promise((resolve, reject) => {\n    canvas.toBlob(\n      (blob) => {\n        if (blob) resolve(blob);\n        else reject(new Error('Failed to create rotated image'));\n      },\n      'image/jpeg',\n      0.95\n    );\n  });\n}\n\nfunction loadImage(file: File): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    const url = URL.createObjectURL(file);\n\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve(img);\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load image'));\n    };\n\n    img.src = url;\n  });\n}\n","const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\nconst MIN_DIMENSION = 512;\nconst MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB\n\nexport class ValidationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'ValidationError';\n  }\n}\n\nexport function validateImage(file: File): void {\n  // Check file type\n  if (!ALLOWED_TYPES.includes(file.type)) {\n    throw new ValidationError(\n      'Please upload a JPEG, PNG, or WebP image.'\n    );\n  }\n\n  // Check file size\n  if (file.size > MAX_FILE_SIZE) {\n    throw new ValidationError(\n      'Image is too large. Please upload an image under 20MB.'\n    );\n  }\n}\n\nexport async function validateDimensions(file: File): Promise<void> {\n  const dimensions = await getImageDimensions(file);\n\n  if (dimensions.width < MIN_DIMENSION || dimensions.height < MIN_DIMENSION) {\n    throw new ValidationError(\n      `Image is too small. Minimum size is ${MIN_DIMENSION}x${MIN_DIMENSION} pixels.`\n    );\n  }\n}\n\nfunction getImageDimensions(file: File): Promise<{ width: number; height: number }> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    const url = URL.createObjectURL(file);\n\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve({ width: img.width, height: img.height });\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new ValidationError('Failed to load image. Please try another file.'));\n    };\n\n    img.src = url;\n  });\n}\n","import { getState, setError, closeWidget } from '../state';\n\nlet abortController: AbortController | null = null;\nlet slowTimer: ReturnType<typeof setTimeout> | null = null;\n\nexport function renderProgress(container: HTMLElement): void {\n  const state = getState();\n\n  container.innerHTML = `\n    <div class=\"progress-content\">\n      <div class=\"spinner\"></div>\n      <p class=\"progress-text\" id=\"progress-text\">${escapeHtml(state.progress || 'Processing...')}</p>\n      <p class=\"progress-subtext\" id=\"progress-subtext\">This may take up to a minute</p>\n      <button class=\"btn btn-secondary cancel-btn\" id=\"progress-cancel\">Cancel</button>\n    </div>\n  `;\n\n  // Show \"taking longer\" message after 30s\n  clearSlowTimer();\n  slowTimer = setTimeout(() => {\n    const subtext = container.querySelector('#progress-subtext');\n    if (subtext) {\n      subtext.textContent = 'Taking longer than usual, please wait...';\n    }\n  }, 30000);\n\n  container.querySelector('#progress-cancel')?.addEventListener('click', () => {\n    cancelProcessing();\n    closeWidget();\n  });\n}\n\nexport function getAbortController(): AbortController {\n  if (abortController) {\n    abortController.abort();\n  }\n  abortController = new AbortController();\n  return abortController;\n}\n\nexport function cancelProcessing(): void {\n  if (abortController) {\n    abortController.abort();\n    abortController = null;\n  }\n  clearSlowTimer();\n}\n\nfunction clearSlowTimer(): void {\n  if (slowTimer) {\n    clearTimeout(slowTimer);\n    slowTimer = null;\n  }\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n","import { getConfig, getApiKey } from '../config';\nimport { getAbortController, cancelProcessing } from '../components/Progress';\n\nconst CLIENT_TIMEOUT = 90_000; // 90 seconds\nconst API_KEY_HEADER = 'x-tryon-api-key';\n\nexport interface TryOnResult {\n  imageBase64: string;\n  mimeType: string;\n}\n\nexport interface ApiError {\n  error: string;\n  code: string;\n  retryable: boolean;\n}\n\nexport async function submitTryOn(\n  userPhoto: File,\n  productImageUrl: string,\n  onProgress?: (message: string) => void\n): Promise<TryOnResult> {\n  const config = getConfig();\n  const controller = getAbortController();\n\n  // Client-side timeout\n  const timeoutId = setTimeout(() => {\n    controller.abort();\n  }, CLIENT_TIMEOUT);\n\n  try {\n    onProgress?.('Uploading your photo...');\n\n    const formData = new FormData();\n    formData.append('userImage', userPhoto);\n    formData.append('productImageUrl', productImageUrl);\n\n    // Simulate progress stages\n    const progressTimer = setInterval(() => {\n      const elapsed = Date.now();\n      const messages = [\n        'Analyzing your photo...',\n        'Preparing the product...',\n        'Creating your look...',\n        'Almost there...'\n      ];\n      // Cycle through messages\n      const index = Math.floor(Math.random() * messages.length);\n      onProgress?.(messages[index]);\n    }, 5000);\n\n    // Build request headers\n    const headers: Record<string, string> = {};\n    const apiKey = getApiKey();\n    if (apiKey) {\n      headers[API_KEY_HEADER] = apiKey;\n    }\n\n    const response = await fetch(`${config.apiBaseUrl}/api/tryon`, {\n      method: 'POST',\n      body: formData,\n      headers,\n      signal: controller.signal\n    });\n\n    clearInterval(progressTimer);\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      const errorData = await parseErrorResponse(response);\n\n      // Handle specific error codes with user-friendly messages\n      let message = errorData.error || 'Try-on failed';\n      if (errorData.code === 'MISSING_API_KEY') {\n        message = 'Widget not configured. Please add your API key.';\n      } else if (errorData.code === 'INVALID_API_KEY') {\n        message = 'Invalid API key. Please check your configuration.';\n      } else if (errorData.code === 'QUOTA_EXCEEDED') {\n        message = 'Usage limit reached. Please try again later.';\n      } else if (errorData.code === 'RATE_LIMIT_EXCEEDED') {\n        message = 'Too many requests. Please wait a moment.';\n      }\n\n      throw new TryOnError(\n        message,\n        errorData.code || 'UNKNOWN',\n        errorData.retryable ?? true\n      );\n    }\n\n    const data = await response.json();\n\n    if (!data.imageBase64) {\n      throw new TryOnError('No image returned', 'NO_IMAGE', true);\n    }\n\n    return {\n      imageBase64: data.imageBase64,\n      mimeType: data.mimeType || 'image/png'\n    };\n  } catch (err: any) {\n    clearTimeout(timeoutId);\n\n    if (err.name === 'AbortError') {\n      throw new TryOnError(\n        'Request timed out. Please try again.',\n        'TIMEOUT',\n        true\n      );\n    }\n\n    if (err instanceof TryOnError) {\n      throw err;\n    }\n\n    throw new TryOnError(\n      'Failed to connect to server. Please check your connection.',\n      'NETWORK_ERROR',\n      true\n    );\n  }\n}\n\nclass TryOnError extends Error {\n  code: string;\n  retryable: boolean;\n\n  constructor(message: string, code: string, retryable: boolean) {\n    super(message);\n    this.name = 'TryOnError';\n    this.code = code;\n    this.retryable = retryable;\n  }\n}\n\nasync function parseErrorResponse(response: Response): Promise<ApiError> {\n  try {\n    return await response.json();\n  } catch {\n    return {\n      error: `Server error (${response.status})`,\n      code: `HTTP_${response.status}`,\n      retryable: response.status >= 500\n    };\n  }\n}\n","import { getState, setState, startProcessing, setProgress, setResult, setError } from '../state';\nimport { compressImage } from '../utils/compression';\nimport { fixOrientation } from '../utils/exif';\nimport { validateImage, ValidationError } from '../utils/validation';\nimport { submitTryOn } from '../services/api';\n\nlet previewUrl: string | null = null;\n\nexport function renderUpload(container: HTMLElement, shadowRoot: ShadowRoot): void {\n  const state = getState();\n  const hasPhoto = state.userPhoto !== null;\n\n  if (hasPhoto) {\n    // Regenerate preview URL if needed (e.g., returning from result view)\n    if (!previewUrl && state.userPhoto) {\n      previewUrl = URL.createObjectURL(state.userPhoto);\n    }\n    if (previewUrl) {\n      renderPreview(container, previewUrl);\n      return;\n    }\n  }\n\n  renderDropzone(container, shadowRoot);\n}\n\nfunction renderDropzone(container: HTMLElement, shadowRoot: ShadowRoot): void {\n  container.innerHTML = `\n    <div class=\"upload-zone\" id=\"upload-zone\">\n      <div class=\"upload-icon\">&#128247;</div>\n      <p class=\"upload-title\">Upload your photo</p>\n      <p class=\"upload-subtitle\">Drag & drop or click to select</p>\n      <input type=\"file\" accept=\"image/jpeg,image/png,image/webp\" capture=\"user\" class=\"upload-input\" id=\"upload-input\" />\n    </div>\n    <div class=\"photo-guidance\">\n      <p class=\"photo-guidance-title\">For best results:</p>\n      Stand facing the camera in good lighting. Full body photos work best for clothing.\n    </div>\n  `;\n\n  const zone = container.querySelector('#upload-zone') as HTMLElement;\n  const input = container.querySelector('#upload-input') as HTMLInputElement;\n\n  zone.addEventListener('click', () => input.click());\n\n  zone.addEventListener('dragover', (e) => {\n    e.preventDefault();\n    zone.classList.add('dragover');\n  });\n\n  zone.addEventListener('dragleave', () => {\n    zone.classList.remove('dragover');\n  });\n\n  zone.addEventListener('drop', (e) => {\n    e.preventDefault();\n    zone.classList.remove('dragover');\n    const file = e.dataTransfer?.files[0];\n    if (file) handleFile(file, container, shadowRoot);\n  });\n\n  input.addEventListener('change', () => {\n    const file = input.files?.[0];\n    if (file) handleFile(file, container, shadowRoot);\n  });\n}\n\nasync function handleFile(file: File, container: HTMLElement, shadowRoot: ShadowRoot): Promise<void> {\n  try {\n    // Validate\n    validateImage(file);\n\n    // Fix EXIF orientation\n    const oriented = await fixOrientation(file);\n\n    // Compress if needed\n    const compressed = await compressImage(oriented);\n\n    // Create preview URL\n    if (previewUrl) URL.revokeObjectURL(previewUrl);\n    previewUrl = URL.createObjectURL(compressed);\n\n    // Store in state\n    setState({ userPhoto: new File([compressed], file.name, { type: compressed.type }) });\n\n    // Re-render with preview\n    renderPreview(container, previewUrl);\n  } catch (err) {\n    if (err instanceof ValidationError) {\n      alert(err.message);\n    } else {\n      console.error('[TryOn] Error processing image:', err);\n      alert('Failed to process image. Please try another photo.');\n    }\n  }\n}\n\nfunction renderPreview(container: HTMLElement, url: string): void {\n  container.innerHTML = `\n    <div class=\"preview-container\">\n      <img src=\"${url}\" alt=\"Your photo\" class=\"preview-image\" />\n      <div class=\"preview-actions\">\n        <button class=\"btn btn-primary\" id=\"preview-submit\">Try On</button>\n        <button class=\"btn btn-secondary\" id=\"preview-retake\">Choose Different</button>\n      </div>\n    </div>\n  `;\n\n  container.querySelector('#preview-submit')?.addEventListener('click', handleSubmit);\n  container.querySelector('#preview-retake')?.addEventListener('click', () => {\n    if (previewUrl) {\n      URL.revokeObjectURL(previewUrl);\n      previewUrl = null;\n    }\n    setState({ userPhoto: null });\n  });\n}\n\nasync function handleSubmit(): Promise<void> {\n  const state = getState();\n  if (!state.userPhoto || !state.productImageUrl) return;\n\n  startProcessing();\n\n  try {\n    const result = await submitTryOn(state.userPhoto, state.productImageUrl, (progress) => {\n      setProgress(progress);\n    });\n\n    setResult(result);\n  } catch (err: any) {\n    setError(err.message || 'Try-on failed. Please try again.');\n  }\n}\n\nexport function cleanupUpload(): void {\n  if (previewUrl) {\n    URL.revokeObjectURL(previewUrl);\n    previewUrl = null;\n  }\n}\n","export type TryOnEventType =\n  | 'tryon:open'\n  | 'tryon:close'\n  | 'tryon:resultReady'\n  | 'tryon:addToCart';\n\nexport interface TryOnEventDetail {\n  productId?: string;\n  productImageUrl?: string;\n  tryOnImage?: string;\n}\n\nexport function dispatchTryOnEvent(type: TryOnEventType, detail?: TryOnEventDetail): void {\n  const event = new CustomEvent(type, {\n    bubbles: true,\n    composed: true,\n    detail: detail || {}\n  });\n  document.dispatchEvent(event);\n}\n","import { getState, retryWithSamePhoto, closeWidget } from '../state';\nimport { dispatchTryOnEvent } from '../events';\n\nlet isZoomed = false;\n\nexport function renderResult(container: HTMLElement): void {\n  const state = getState();\n  if (!state.result) {\n    container.innerHTML = '<p>No result available</p>';\n    return;\n  }\n\n  const imageSrc = `data:${state.result.mimeType};base64,${state.result.imageBase64}`;\n  isZoomed = false;\n\n  container.innerHTML = `\n    <div class=\"result-content\">\n      <div class=\"result-image-container\" id=\"result-container\">\n        <img src=\"${imageSrc}\" alt=\"Try-on result\" class=\"result-image\" id=\"result-image\" />\n      </div>\n      <p class=\"zoom-hint\">Click image to zoom</p>\n      <div class=\"result-actions\">\n        <button class=\"btn btn-success\" id=\"result-add-cart\">Add to Cart</button>\n        <button class=\"btn btn-secondary\" id=\"result-try-another\">Try Another</button>\n      </div>\n    </div>\n  `;\n\n  const imageContainer = container.querySelector('#result-container') as HTMLElement;\n  const image = container.querySelector('#result-image') as HTMLImageElement;\n\n  imageContainer.addEventListener('click', () => {\n    isZoomed = !isZoomed;\n    if (isZoomed) {\n      image.classList.add('zoomed');\n    } else {\n      image.classList.remove('zoomed');\n    }\n  });\n\n  container.querySelector('#result-add-cart')?.addEventListener('click', () => {\n    dispatchTryOnEvent('tryon:addToCart', {\n      productId: state.productId,\n      productImageUrl: state.productImageUrl,\n      tryOnImage: imageSrc\n    });\n    closeWidget();\n  });\n\n  container.querySelector('#result-try-another')?.addEventListener('click', () => {\n    retryWithSamePhoto();\n  });\n\n  // Dispatch result ready event\n  dispatchTryOnEvent('tryon:resultReady', {\n    productId: state.productId,\n    productImageUrl: state.productImageUrl,\n    tryOnImage: imageSrc\n  });\n}\n","import { getState, closeWidget, subscribe, retryWithSamePhoto, View } from '../state';\nimport { renderConsent } from './ConsentGate';\nimport { renderUpload } from './Upload';\nimport { renderProgress } from './Progress';\nimport { renderResult } from './Result';\n\nexport function createModal(shadowRoot: ShadowRoot): HTMLElement {\n  const backdrop = document.createElement('div');\n  backdrop.className = 'backdrop';\n\n  const modal = document.createElement('div');\n  modal.className = 'modal';\n\n  const header = document.createElement('div');\n  header.className = 'header';\n\n  const title = document.createElement('h2');\n  title.className = 'title';\n  title.textContent = 'Virtual Try-On';\n\n  const closeBtn = document.createElement('button');\n  closeBtn.className = 'close-btn';\n  closeBtn.innerHTML = '&times;';\n  closeBtn.setAttribute('aria-label', 'Close');\n  closeBtn.addEventListener('click', closeWidget);\n\n  header.appendChild(title);\n  header.appendChild(closeBtn);\n  modal.appendChild(header);\n\n  const content = document.createElement('div');\n  content.className = 'content';\n  modal.appendChild(content);\n\n  backdrop.appendChild(modal);\n\n  backdrop.addEventListener('click', (e) => {\n    if (e.target === backdrop) {\n      closeWidget();\n    }\n  });\n\n  // Subscribe to state changes and render appropriate view\n  subscribe((state) => {\n    renderView(content, state.view, shadowRoot);\n\n    if (state.view === 'closed') {\n      backdrop.classList.remove('visible');\n    } else {\n      backdrop.classList.add('visible');\n    }\n  });\n\n  return backdrop;\n}\n\nfunction renderView(container: HTMLElement, view: View, shadowRoot: ShadowRoot): void {\n  const state = getState();\n\n  switch (view) {\n    case 'closed':\n      container.innerHTML = '';\n      break;\n    case 'consent':\n      renderConsent(container);\n      break;\n    case 'upload':\n      renderUpload(container, shadowRoot);\n      break;\n    case 'processing':\n      renderProgress(container);\n      break;\n    case 'result':\n      renderResult(container);\n      break;\n    case 'error':\n      renderError(container, state.error || 'An unexpected error occurred');\n      break;\n  }\n}\n\nfunction renderError(container: HTMLElement, errorMessage: string): void {\n  container.innerHTML = `\n    <div class=\"error-content\">\n      <div class=\"error-icon\">!</div>\n      <h3 class=\"error-title\">Something went wrong</h3>\n      <p class=\"error-text\">${escapeHtml(errorMessage)}</p>\n      <div class=\"result-actions\">\n        <button class=\"btn btn-primary\" id=\"error-retry\">Try Again</button>\n        <button class=\"btn btn-secondary\" id=\"error-close\">Close</button>\n      </div>\n    </div>\n  `;\n\n  container.querySelector('#error-retry')?.addEventListener('click', retryWithSamePhoto);\n  container.querySelector('#error-close')?.addEventListener('click', closeWidget);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n","import { openWidget, closeWidget, setState, getState } from './state';\nimport { dispatchTryOnEvent } from './events';\nimport { setConfig, WidgetConfig } from './config';\n\nexport interface TryOnAPI {\n  open(options?: { productImage?: string; productId?: string }): void;\n  close(): void;\n  setProduct(imageUrl: string, productId?: string): void;\n  _init(config: Partial<WidgetConfig>): void;\n  _ready: boolean;\n}\n\nexport function createAPI(): TryOnAPI {\n  return {\n    _ready: true,\n\n    open(options) {\n      const productImage = options?.productImage || getState().productImageUrl;\n      const productId = options?.productId || getState().productId;\n\n      if (!productImage) {\n        console.warn('[TryOn] No product image specified');\n        return;\n      }\n\n      openWidget(productImage, productId);\n      dispatchTryOnEvent('tryon:open', { productImageUrl: productImage, productId });\n    },\n\n    close() {\n      closeWidget();\n      dispatchTryOnEvent('tryon:close');\n    },\n\n    setProduct(imageUrl, productId) {\n      setState({ productImageUrl: imageUrl, productId });\n    },\n\n    _init(config) {\n      setConfig(config);\n    }\n  };\n}\n","import { styles } from './styles';\nimport { subscribe, getState, closeWidget } from './state';\nimport { createModal } from './components/Modal';\nimport { createAPI } from './api';\n\nconst HOST_ID = 'tryon-widget-host';\n\nlet host: HTMLElement | null = null;\nlet shadowRoot: ShadowRoot | null = null;\n\nfunction initWidget(): void {\n  // Check if already initialized\n  if (document.getElementById(HOST_ID)) {\n    return;\n  }\n\n  // Create host element with max z-index\n  host = document.createElement('div');\n  host.id = HOST_ID;\n  host.style.cssText = `\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    z-index: 2147483647;\n    pointer-events: none;\n  `;\n\n  // Attach Shadow DOM (closed mode for full isolation)\n  shadowRoot = host.attachShadow({ mode: 'closed' });\n\n  // Inject styles\n  const styleEl = document.createElement('style');\n  styleEl.textContent = styles;\n  shadowRoot.appendChild(styleEl);\n\n  // Create modal structure\n  const modal = createModal(shadowRoot);\n  modal.style.pointerEvents = 'auto';\n  shadowRoot.appendChild(modal);\n\n  // Handle visibility\n  subscribe((state) => {\n    if (state.view === 'closed') {\n      host!.style.pointerEvents = 'none';\n    } else {\n      host!.style.pointerEvents = 'auto';\n    }\n  });\n\n  // Handle escape key\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape' && getState().view !== 'closed') {\n      closeWidget();\n    }\n  });\n\n  document.body.appendChild(host);\n}\n\n// Initialize on load\nfunction init(): void {\n  initWidget();\n\n  // Expose public API (overwrites loader)\n  const api = createAPI();\n  (window as any).TryOn = api;\n}\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n// Export for module usage\nexport { createAPI };\n"],"names":["styles","initialState","state","listeners","getState","setState","partial","listener","subscribe","openWidget","productImageUrl","productId","hasConsent","closeWidget","setConsent","accepted","startProcessing","setProgress","progress","setResult","result","setError","error","retryWithSamePhoto","defaultConfig","config","getConfig","setConfig","newConfig","getApiKey","renderConsent","container","_a","_b","privacyUrl","escapeAttr","text","MAX_DIMENSION","MAX_BYTES","INITIAL_QUALITY","MIN_QUALITY","QUALITY_STEP","compressImage","file","maxBytes","img","loadImage","width","height","ratio","canvas","ctx","quality","blob","canvasToBlob","resolve","reject","url","type","fixOrientation","orientation","getExifOrientation","rotateImage","buffer","view","offset","marker","length","littleEndian","ifdOffset","numEntries","i","ALLOWED_TYPES","MAX_FILE_SIZE","ValidationError","message","validateImage","abortController","slowTimer","renderProgress","escapeHtml","clearSlowTimer","subtext","cancelProcessing","getAbortController","div","CLIENT_TIMEOUT","API_KEY_HEADER","submitTryOn","userPhoto","onProgress","controller","timeoutId","formData","progressTimer","elapsed","messages","index","headers","apiKey","response","errorData","parseErrorResponse","TryOnError","data","err","code","retryable","__publicField","previewUrl","renderUpload","shadowRoot","renderPreview","renderDropzone","zone","input","e","handleFile","oriented","compressed","handleSubmit","dispatchTryOnEvent","detail","event","isZoomed","renderResult","imageSrc","imageContainer","image","createModal","backdrop","modal","header","title","closeBtn","content","renderView","renderError","errorMessage","createAPI","options","productImage","imageUrl","HOST_ID","host","initWidget","styleEl","init","api"],"mappings":"oKAAO,MAAMA,EAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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"}